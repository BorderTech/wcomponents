<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../resources/report.gif" type="image/gif"/><title>WValidationErrors.java</title><link rel="stylesheet" href="../../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">WComponents Coverage</a> &gt; <a href="../index.html" class="el_bundle">WComponents</a> &gt; <a href="index.source.html" class="el_package">com.github.bordertech.wcomponents.validation</a> &gt; <span class="el_source">WValidationErrors.java</span></div><h1>WValidationErrors.java</h1><pre class="source lang-java linenums">package com.github.bordertech.wcomponents.validation;

import com.github.bordertech.wcomponents.AbstractWComponent;
import com.github.bordertech.wcomponents.ComponentModel;
import com.github.bordertech.wcomponents.util.I18nUtilities;
import java.io.Serializable;
import java.text.MessageFormat;
import java.util.ArrayList;
import java.util.Collections;
import java.util.List;

/**
 * &lt;p&gt;
 * This component is used to render an error message box (commonly near the top of an application's UI) which contains
 * all supplied validation errors.
 * &lt;/p&gt;
 * &lt;p&gt;
 * This provides (in conjuntion with {@link WFieldErrorIndicator} components) the ability to link error messages with
 * the input field that is in error.
 * &lt;/p&gt;
 * &lt;p&gt;
 * NOTE: The collection of errors passed to this component must be implementations of {@link Diagnostic}.
 * &lt;/p&gt;
 *
 * @see Diagnostic
 * @see com.github.bordertech.wcomponents.WMessages
 *
 * @author Adam Millard
 * @author Mark Reeves
 * @since 1.0.0
 */
<span class="fc" id="L32">public class WValidationErrors extends AbstractWComponent {</span>

	/**
	 * Clears the errors for a given user.
	 */
	public void clearErrors() {
<span class="fc" id="L38">		getOrCreateComponentModel().errors.clear();</span>
<span class="fc" id="L39">	}</span>

	/**
	 * Sets the errors for a given user.
	 *
	 * @param errors the errors to set.
	 */
	public void setErrors(final List&lt;Diagnostic&gt; errors) {
<span class="pc bpc" id="L47" title="1 of 2 branches missed.">		if (errors != null) {</span>
<span class="fc" id="L48">			ValidationErrorsModel model = getOrCreateComponentModel();</span>

<span class="fc bfc" id="L50" title="All 2 branches covered.">			for (Diagnostic error : errors) {</span>
<span class="pc bpc" id="L51" title="1 of 2 branches missed.">				if (error.getSeverity() == Diagnostic.ERROR) {</span>
<span class="fc" id="L52">					model.errors.add(error);</span>
				}
<span class="fc" id="L54">			}</span>
		}
<span class="fc" id="L56">	}</span>

	/**
	 * Retrieves the errors for a given user.
	 *
	 * @return the list of errors for the given user.
	 */
	public List&lt;Diagnostic&gt; getErrors() {
<span class="fc" id="L64">		return Collections.unmodifiableList(getComponentModel().errors);</span>
	}

	/**
	 * Indicates whether there are any validation errors.
	 *
	 * @return true if there are validation errors, false otherwise.
	 */
	public boolean hasErrors() {
<span class="fc" id="L73">		ValidationErrorsModel model = getComponentModel();</span>
<span class="fc bfc" id="L74" title="All 2 branches covered.">		return !model.errors.isEmpty();</span>
	}

	/**
	 * Groups the errors by their source field.
	 *
	 * @return a list of grouped errors.
	 */
	public List&lt;GroupedDiagnositcs&gt; getGroupedErrors() {
<span class="fc" id="L83">		List&lt;GroupedDiagnositcs&gt; grouped = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L84">		Diagnostic previousError = null;</span>
<span class="fc" id="L85">		GroupedDiagnositcs group = null;</span>

<span class="fc bfc" id="L87" title="All 2 branches covered.">		for (Diagnostic theError : getErrors()) {</span>
<span class="fc bfc" id="L88" title="All 2 branches covered.">			boolean isNewField = ((previousError == null) || (previousError.getContext() != theError.</span>
<span class="pc bpc" id="L89" title="1 of 2 branches missed.">					getContext())</span>
<span class="fc bfc" id="L90" title="All 2 branches covered.">					|| (previousError.getComponent() != theError.getComponent()));</span>

<span class="fc bfc" id="L92" title="All 4 branches covered.">			if (group == null || isNewField) {</span>
<span class="fc" id="L93">				group = new GroupedDiagnositcs();</span>
<span class="fc" id="L94">				grouped.add(group);</span>
			}

<span class="fc" id="L97">			group.addDiagnostic(theError);</span>

<span class="fc" id="L99">			previousError = theError;</span>
<span class="fc" id="L100">		}</span>

<span class="fc" id="L102">		return Collections.unmodifiableList(grouped);</span>
	}

	/**
	 * Groups a set of related diagnostics.
	 */
<span class="fc" id="L108">	public static class GroupedDiagnositcs {</span>

		/**
		 * The grouped diagnostics.
		 */
<span class="fc" id="L113">		private final List&lt;Diagnostic&gt; diags = new ArrayList&lt;&gt;();</span>

		/**
		 * Adds a diagnostic to this group.
		 *
		 * @param diag the diagnostic to add.
		 */
		public void addDiagnostic(final Diagnostic diag) {
<span class="fc" id="L121">			diags.add(diag);</span>
<span class="fc" id="L122">		}</span>

		/**
		 * @return the diagnostics contained in this group.
		 */
		public List&lt;Diagnostic&gt; getDiagnostics() {
<span class="fc" id="L128">			return Collections.unmodifiableList(diags);</span>
		}
	}

	/**
	 * @return a String representation of this component, for debugging purposes.
	 */
	@Override
	public String toString() {
<span class="nc" id="L137">		return getClass().getSimpleName() + '(' + getErrors() + ')';</span>
	}



	/**
	 * Sets the message box title.
	 *
	 * @param title the message box title to set, using {@link MessageFormat} syntax.
	 * @param args optional arguments for the message format string.
	 */
	public void setTitleText(final String title, final Serializable... args) {
<span class="fc" id="L149">		ValidationErrorsModel model = getOrCreateComponentModel();</span>
<span class="fc" id="L150">		model.title = I18nUtilities.asMessage(title, args);</span>
<span class="fc" id="L151">	}</span>

	/**
	 * @return the message box title.
	 */
	public String getTitleText() {
<span class="fc" id="L157">		return I18nUtilities.format(null, getComponentModel().title);</span>
	}

	// --------------------------------
	// Extrinsic state management
	/**
	 * Holds the extrinsic state information of a WValidationErrors.
	 */
<span class="fc" id="L165">	public static class ValidationErrorsModel extends ComponentModel {</span>

		/**
		 * The validation errors.
		 */
<span class="fc" id="L170">		private final List&lt;Diagnostic&gt; errors = new ArrayList&lt;&gt;();</span>

		/**
		 * The validation title text.
		 */
		private Serializable title;
	}

	/**
	 * Creates a new component model appropriate for this component.
	 *
	 * @return a new ValidationErrorsModel.
	 */
	@Override
	protected ValidationErrorsModel newComponentModel() {
<span class="fc" id="L185">		return new ValidationErrorsModel();</span>
	}

	/**
	 * {@inheritDoc}
	 */
	@Override // For type safety only
	protected ValidationErrorsModel getComponentModel() {
<span class="fc" id="L193">		return (ValidationErrorsModel) super.getComponentModel();</span>
	}

	/**
	 * {@inheritDoc}
	 */
	@Override // For type safety only
	protected ValidationErrorsModel getOrCreateComponentModel() {
<span class="fc" id="L201">		return (ValidationErrorsModel) super.getOrCreateComponentModel();</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>