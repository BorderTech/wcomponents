<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../resources/report.gif" type="image/gif"/><title>MockHttpServletResponse.java</title><link rel="stylesheet" href="../../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">WComponents Coverage</a> &gt; <a href="../index.html" class="el_bundle">WComponents</a> &gt; <a href="index.source.html" class="el_package">com.github.bordertech.wcomponents.util.mock.servlet</a> &gt; <span class="el_source">MockHttpServletResponse.java</span></div><h1>MockHttpServletResponse.java</h1><pre class="source lang-java linenums">package com.github.bordertech.wcomponents.util.mock.servlet;

import java.io.IOException;
import java.io.PrintWriter;
import java.io.StringWriter;
import java.io.UnsupportedEncodingException;
import java.util.HashMap;
import java.util.Locale;
import java.util.Map;
import java.util.Set;
import javax.servlet.ServletOutputStream;
import javax.servlet.http.Cookie;
import javax.servlet.http.HttpServletResponse;

/**
 * A mock http servlet response, useful for unit testing. Extracted from PortalBridge_Test
 *
 * @author Yiannis Paschalidis
 * @since 1.0.0
 */
<span class="fc" id="L21">public class MockHttpServletResponse implements HttpServletResponse {</span>

	private String sendRedirection;
	private String contentType;
<span class="fc" id="L25">	private String characterEncoding = &quot;UTF-8&quot;;</span>
<span class="fc" id="L26">	private final Map headers = new HashMap();</span>
	private MockServletOutputStream outputStream;
	private PrintWriter printWriter;
	private StringWriter stringWriter;
<span class="fc" id="L30">	private int status = HttpServletResponse.SC_OK;</span>

	/**
	 * Unimplemented.
	 *
	 * @param arg0 ignored.
	 */
	@Override
	public void addCookie(final Cookie arg0) {
		// No effect
<span class="nc" id="L40">	}</span>

	/**
	 * Unimplemented.
	 *
	 * @param arg0 ignored.
	 * @param arg1 ignored.
	 */
	@Override
	public void addDateHeader(final String arg0, final long arg1) {
		// No effect
<span class="nc" id="L51">	}</span>

	/**
	 * Headers added are recorded for later access.
	 *
	 * @param key header key of the value to be added.
	 * @param value header value.
	 */
	@Override
	public void addHeader(final String key, final String value) {
<span class="nc" id="L61">		headers.put(key, value);</span>
<span class="nc" id="L62">	}</span>

	/**
	 * Unimplemented.
	 *
	 * @param arg0 ignored.
	 * @param arg1 ignored.
	 */
	@Override
	public void addIntHeader(final String arg0, final int arg1) {
		// No effect
<span class="nc" id="L73">	}</span>

	/**
	 * Determines whether the specified header exists.
	 *
	 * @param name the header name.
	 * @return true if the specified header has been set.
	 */
	@Override
	public boolean containsHeader(final String name) {
<span class="nc" id="L83">		return headers.containsKey(name);</span>
	}

	/**
	 * @return The set of header keys added.
	 */
	public Set getHeaderKeys() {
<span class="nc" id="L90">		return headers.keySet();</span>
	}

	/**
	 * Unimplemented.
	 *
	 * @param url the url.
	 * @return the unmodified url.
	 */
	@Override
	public String encodeRedirectUrl(final String url) {
<span class="nc" id="L101">		return url;</span>
	}

	/**
	 * Unimplemented.
	 *
	 * @param url the url.
	 * @return the unmodified url.
	 */
	@Override
	public String encodeRedirectURL(final String url) {
<span class="nc" id="L112">		return url;</span>
	}

	/**
	 * Unimplemented.
	 *
	 * @param url the url.
	 * @return the unmodified url.
	 */
	@Override
	public String encodeUrl(final String url) {
<span class="nc" id="L123">		return url;</span>
	}

	/**
	 * Unimplemented.
	 *
	 * @param url the url.
	 * @return the unmodified url.
	 */
	@Override
	public String encodeURL(final String url) {
		// no need to encode
<span class="nc" id="L135">		return url;</span>
	}

	/**
	 * Sets the HTTP response status to indicate an error.
	 *
	 * @param errorStatus the status code, e.g. 404 for not found.
	 * @param arg1 ignored.
	 */
	@Override
	public void sendError(final int errorStatus, final String arg1) {
<span class="fc" id="L146">		this.status = errorStatus;</span>
<span class="fc" id="L147">	}</span>

	/**
	 * Sets the HTTP response status to indicate an error.
	 *
	 * @param errorStatus the status code, e.g. 404 for not found.
	 */
	@Override
	public void sendError(final int errorStatus) {
<span class="nc" id="L156">		this.status = errorStatus;</span>
<span class="nc" id="L157">	}</span>

	/**
	 * Sets the redirect url.
	 *
	 * @param url the redirect url.
	 */
	@Override
	public void sendRedirect(final String url) {
<span class="fc" id="L166">		sendRedirection = url;</span>
<span class="fc" id="L167">	}</span>

	/**
	 * Sets a date header.
	 *
	 * @param name the header name.
	 * @param value the header value.
	 */
	@Override
	public void setDateHeader(final String name, final long value) {
<span class="nc" id="L177">		headers.put(name, String.valueOf(value));</span>
<span class="nc" id="L178">	}</span>

	/**
	 * Sets a header.
	 *
	 * @param name the header name.
	 * @param value the header value.
	 */
	@Override
	public void setHeader(final String name, final String value) {
<span class="fc" id="L188">		headers.put(name, value);</span>
<span class="fc" id="L189">	}</span>

	/**
	 * Sets an integer header.
	 *
	 * @param name the header name.
	 * @param value the header value.
	 */
	@Override
	public void setIntHeader(final String name, final int value) {
<span class="nc" id="L199">		headers.put(name, String.valueOf(value));</span>
<span class="nc" id="L200">	}</span>

	/**
	 * Sets the HTTP response status.
	 *
	 * @param statusCode the status code, e.g. 404 for not found.
	 * @param arg1 ignored.
	 */
	@Override
	public void setStatus(final int statusCode, final String arg1) {
<span class="nc" id="L210">		this.status = statusCode;</span>
<span class="nc" id="L211">	}</span>

	/**
	 * Sets the HTTP response status.
	 *
	 * @param status the status code, e.g. 404 for not found.
	 */
	@Override
	public void setStatus(final int status) {
<span class="fc" id="L220">		this.status = status;</span>
<span class="fc" id="L221">	}</span>

	/**
	 * Unimplemented.
	 */
	@Override
	public void flushBuffer() {
		// No effect
<span class="nc" id="L229">	}</span>

	/**
	 * @return 0, as this is unimplemented.
	 */
	@Override
	public int getBufferSize() {
<span class="nc" id="L236">		return 0;</span>
	}

	/**
	 * @return The character encoding used by the StringWriter.
	 */
	@Override
	public String getCharacterEncoding() {
<span class="nc" id="L244">		return characterEncoding;</span>
	}

	/**
	 * @return null, as this is unimplemented.
	 */
	@Override
	public Locale getLocale() {
<span class="nc" id="L252">		return null;</span>
	}

	/**
	 * Returns a ServletOutputStream that would normally be used to write content back to the client. Instead, the
	 * content is held internally and may be retrieved by calling {@link #getOutput()}.
	 *
	 * @return a ServletOutputStream to write content to.
	 * @throws IOException if {@link #getWriter()} has been called.
	 */
	@Override
	public ServletOutputStream getOutputStream() throws IOException {
<span class="pc bpc" id="L264" title="1 of 2 branches missed.">		if (printWriter != null) {</span>
<span class="nc" id="L265">			throw new IOException(&quot;getWriter method has been called on this response&quot;);</span>
		}

<span class="fc bfc" id="L268" title="All 2 branches covered.">		if (outputStream == null) {</span>
<span class="fc" id="L269">			outputStream = new MockServletOutputStream();</span>
		}

<span class="fc" id="L272">		return outputStream;</span>
	}

	/**
	 * Returns a PrintWriter that would normally be used to write content back to the client. Instead, the content is
	 * held internally and may be retrieved by calling {@link #getOutput()}.
	 *
	 * @return a PrintWriter to write content to.
	 * @throws IOException if {@link #getOutputStream()} has been called.
	 */
	@Override
	public PrintWriter getWriter() throws IOException {
<span class="pc bpc" id="L284" title="1 of 2 branches missed.">		if (outputStream != null) {</span>
<span class="nc" id="L285">			throw new IOException(&quot;getOutputStream method has been called on this response&quot;);</span>
		}

<span class="fc bfc" id="L288" title="All 2 branches covered.">		if (printWriter == null) {</span>
<span class="fc" id="L289">			stringWriter = new StringWriter();</span>
<span class="fc" id="L290">			printWriter = new PrintWriter(stringWriter);</span>
		}

<span class="fc" id="L293">		return printWriter;</span>
	}

	/**
	 * @return false, as unimplemented.
	 */
	@Override
	public boolean isCommitted() {
<span class="nc" id="L301">		return false;</span>
	}

	/**
	 * Unimplemented.
	 */
	@Override
	public void reset() {
		// No effect
<span class="nc" id="L310">	}</span>

	/**
	 * Unimplemented.
	 */
	@Override
	public void resetBuffer() {
		// No effect
<span class="nc" id="L318">	}</span>

	/**
	 * Unimplemented.
	 *
	 * @param arg0 ignored.
	 */
	@Override
	public void setBufferSize(final int arg0) {
		// No effect
<span class="nc" id="L328">	}</span>

	/**
	 * Unimplemented.
	 *
	 * @param arg0 ignored.
	 */
	@Override
	public void setContentLength(final int arg0) {
		// No effect
<span class="fc" id="L338">	}</span>

	/**
	 * Sets the response content type.
	 *
	 * @param contentType the content type.
	 */
	@Override
	public void setContentType(final String contentType) {
<span class="fc" id="L347">		this.contentType = contentType;</span>
<span class="fc" id="L348">	}</span>

	/**
	 * Unimplemented.
	 *
	 * @param arg0 ignored.
	 */
	@Override
	public void setLocale(final Locale arg0) {
		// No effect
<span class="nc" id="L358">	}</span>

	/**
	 * @return the response content type.
	 */
	@Override
	public String getContentType() {
<span class="fc" id="L365">		return contentType;</span>
	}

	/**
	 * Sets the contentEncoding for the StringWriter.
	 *
	 * @param contentEncoding The name of the content encoding for the stringWriter.
	 */
	@Override
	public void setCharacterEncoding(final String contentEncoding) {
<span class="nc" id="L375">		this.characterEncoding = contentEncoding;</span>
<span class="nc" id="L376">	}</span>

	/**
	 * @return the redirect URL.
	 */
	public String getSendRedirection() {
<span class="fc" id="L382">		return sendRedirection;</span>
	}

	/**
	 * Returns the value of the specified header.
	 *
	 * @param name the header name.
	 * @return the value of the specified header, or null if it has not been set.
	 */
	public String getHeader(final String name) {
<span class="fc" id="L392">		return (String) headers.get(name);</span>
	}

	/**
	 * Retrieves the content written to the response.
	 *
	 * @return the content written to the response outputStream or printWriter. Null is returned if neither
	 * {@link #getOutputStream()} or {@link #getWriter()} have been called.
	 */
	public byte[] getOutput() {
<span class="fc bfc" id="L402" title="All 2 branches covered.">		if (stringWriter != null) {</span>
<span class="fc" id="L403">			byte[] output = null;</span>

<span class="fc" id="L405">			String string = stringWriter.toString();</span>
<span class="pc bpc" id="L406" title="1 of 2 branches missed.">			if (string != null) {</span>
				try {
<span class="fc" id="L408">					output = string.getBytes(characterEncoding);</span>
<span class="nc" id="L409">				} catch (UnsupportedEncodingException uue) {</span>
<span class="nc" id="L410">					output = null;</span>
<span class="fc" id="L411">				}</span>
			}

<span class="fc" id="L414">			return output;</span>
<span class="pc bpc" id="L415" title="1 of 2 branches missed.">		} else if (outputStream != null) {</span>
<span class="nc" id="L416">			return outputStream.getOutput();</span>
		}

<span class="fc" id="L419">		return null;</span>
	}

	/**
	 * Retrieves the content written to the response.
	 *
	 * @return the content written to the response outputStream or printWriter. Null is returned if neither
	 * {@link #getOutputStream()} or {@link #getWriter()} have been called.
	 */
	public String getOutputAsString() {
<span class="nc bnc" id="L429" title="All 2 branches missed.">		if (stringWriter != null) {</span>
<span class="nc" id="L430">			return stringWriter.toString();</span>
<span class="nc bnc" id="L431" title="All 2 branches missed.">		} else if (outputStream != null) {</span>
<span class="nc" id="L432">			String outputStr = null;</span>

<span class="nc" id="L434">			byte[] bytes = outputStream.getOutput();</span>
<span class="nc bnc" id="L435" title="All 2 branches missed.">			if (bytes != null) {</span>
				try {
<span class="nc" id="L437">					outputStr = new String(bytes, characterEncoding);</span>
<span class="nc" id="L438">				} catch (UnsupportedEncodingException e) {</span>
<span class="nc" id="L439">					outputStr = null;</span>
<span class="nc" id="L440">				}</span>
			}

<span class="nc" id="L443">			return outputStr;</span>
		}

<span class="nc" id="L446">		return null;</span>
	}

	/**
	 * @return the response status code.
	 */
	public int getStatus() {
<span class="fc" id="L453">		return status;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>