<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../resources/report.gif" type="image/gif"/><title>WDialog.java</title><link rel="stylesheet" href="../../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">WComponents Coverage</a> &gt; <a href="../index.html" class="el_bundle">WComponents</a> &gt; <a href="index.source.html" class="el_package">com.github.bordertech.wcomponents</a> &gt; <span class="el_source">WDialog.java</span></div><h1>WDialog.java</h1><pre class="source lang-java linenums">package com.github.bordertech.wcomponents;

import com.github.bordertech.wcomponents.util.I18nUtilities;
import java.io.Serializable;
import java.text.MessageFormat;
import java.util.List;

/**
 * &lt;p&gt;
 * WDialog is used to display pop-up content. It uses theme and skin features which keep the dialog associated with its
 * parent window. Using a {@link #MODAL} dialog eliminates much of the workflow complication involved when using the
 * {@link WWindow} component.
 * &lt;/p&gt;
 * &lt;p&gt;
 * The content of the dialog is held in a {@link WNamingContext} with an id of &quot;dlg&quot; to make the ids of the content
 * unique and have the same id prefix.
 * &lt;/p&gt;
 *
 * @author Christina Harris
 * @since 1.0.0
 */
public class WDialog extends AbstractWComponent implements Container, AjaxTarget {

	/**
	 * This is the &quot;normal&quot; state for the Dialog component, when the dialog is not visible.
	 */
	public static final int INACTIVE_STATE = 0;

	/**
	 * This state is when the dialog is open and the initial render of the content is complete.
	 */
	public static final int ACTIVE_STATE = 2;

	/**
	 * In this mode the dialog retains the input focus while open. The user cannot switch windows until the dialog box
	 * is closed.
	 */
	public static final int MODAL = 0;

	/**
	 * In this mode the dialog displays even when the user switches input focus to the window.
	 */
	public static final int MODELESS = 1;

	/**
	 * The button used to trigger the dialog.
	 */
	private final WButton trigger;

	/**
	 * The content holder exists to keep the content hidden from normal requests, yet still have the content attached to
	 * the wcomponent tree. Being part of the tree enables embedded targetables and other components to be found.
	 * &lt;p&gt;
	 * The holder is a naming context to make the ids in the dialog all unique and have the same prefix.
	 * &lt;/p&gt;
	 */
<span class="fc" id="L57">	private final WNamingContext holder = new WNamingContext(&quot;dlg&quot;) {</span>
		@Override
		public boolean isVisible() {
			// The content is only visible when the dialog is being displayed
<span class="fc bfc" id="L61" title="All 2 branches covered.">			return getState() == ACTIVE_STATE;</span>
		}

		@Override
		public String getNamingContextId() {
			// Build Id
<span class="fc" id="L67">			StringBuffer id = new StringBuffer();</span>
<span class="fc" id="L68">			id.append(WDialog.this.getId());</span>
<span class="fc" id="L69">			id.append(ID_CONTEXT_SEPERATOR);</span>
<span class="fc" id="L70">			id.append(getIdName());</span>
<span class="fc" id="L71">			return id.toString();</span>
		}
	};

	/**
	 * Creates a WDialog.
	 */
	public WDialog() {
<span class="fc" id="L79">		this(null);</span>
<span class="fc" id="L80">	}</span>

	/**
	 * Creates a WDialog containing the given content.
	 *
	 * @param content the dialog content.
	 */
	public WDialog(final WComponent content) {
<span class="fc" id="L88">		this(content, null);</span>
<span class="fc" id="L89">	}</span>

	/**
	 * Creates a WDialog containing the given content and trigger. The dialog will be opened client-side, without a
	 * round-trip.
	 *
	 * @param content the dialog content.
	 * @param trigger the WButton used to trigger the dialog to display.
	 */
<span class="fc" id="L98">	public WDialog(final WComponent content, final WButton trigger) {</span>
<span class="fc" id="L99">		add(holder);</span>

<span class="fc bfc" id="L101" title="All 2 branches covered.">		if (content != null) {</span>
<span class="fc" id="L102">			setContent(content);</span>
		}

<span class="fc" id="L105">		this.trigger = trigger;</span>

<span class="fc bfc" id="L107" title="All 2 branches covered.">		if (trigger != null) {</span>
<span class="fc" id="L108">			add(trigger);</span>
		}
<span class="fc" id="L110">	}</span>

	/**
	 * Set the WComponent which will handle the content for this dialog.
	 *
	 * @param content the dialog content.
	 */
	public void setContent(final WComponent content) {
<span class="fc" id="L118">		getOrCreateComponentModel().content = content;</span>

		// There should only be one content.
<span class="fc" id="L121">		holder.removeAll();</span>
<span class="fc" id="L122">		holder.add(content);</span>
<span class="fc" id="L123">	}</span>

	/**
	 * @return the WComponent that handles the content for this dialog.
	 */
	public WComponent getContent() {
<span class="fc" id="L129">		return getComponentModel().content;</span>
	}

	/**
	 * @return the WButton which is used to trigger the dialog.
	 */
	public WComponent getTrigger() {
<span class="fc" id="L136">		return trigger;</span>
	}

	/**
	 * Signals that the dialog should be opened.
	 */
	public void display() {
<span class="fc" id="L143">		getOrCreateComponentModel().state = ACTIVE_STATE;</span>
<span class="fc" id="L144">	}</span>

	/**
	 * @return The height of the dialog. The default is 600 pixels.
	 */
	public int getHeight() {
<span class="fc" id="L150">		return getComponentModel().height;</span>
	}

	/**
	 * Sets the dialog height. A value of &amp;lt;=0 means &quot;unspecified&quot;.
	 *
	 * @param height The height of the dialog, in pixels.
	 */
	public void setHeight(final int height) {
<span class="fc" id="L159">		getOrCreateComponentModel().height = height;</span>
<span class="fc" id="L160">	}</span>

	/**
	 * @return The width of the dialog. The default is 800 pixels.
	 */
	public int getWidth() {
<span class="fc" id="L166">		return getComponentModel().width;</span>
	}

	/**
	 * Sets the dialog width. A value of &amp;lt;=0 means &quot;unspecified&quot;.
	 *
	 * @param width The width of the dialog, in pixels.
	 */
	public void setWidth(final int width) {
<span class="fc" id="L175">		getOrCreateComponentModel().width = width;</span>
<span class="fc" id="L176">	}</span>

	/**
	 * @return true if the dialog is resizable.
	 */
	public boolean isResizable() {
<span class="fc" id="L182">		return getComponentModel().resizable;</span>
	}

	/**
	 * Sets whether the dialog is resizable.
	 *
	 * @param resizable true if the dialog should be resizable, false if not.
	 */
	public void setResizable(final boolean resizable) {
<span class="fc" id="L191">		getOrCreateComponentModel().resizable = resizable;</span>
<span class="fc" id="L192">	}</span>

	/**
	 * Set the relationship of the dialog to the parent window.
	 *
	 * @param mode the dialog mode; {@link #MODAL} or {@link #MODELESS}.
	 */
	public void setMode(final int mode) {
<span class="fc" id="L200">		getOrCreateComponentModel().mode = mode;</span>
<span class="fc" id="L201">	}</span>

	/**
	 * Returns the relationship of the dialog to the parent window.
	 *
	 * @return {@link #MODAL} or {@link #MODELESS}.
	 */
	public int getMode() {
<span class="fc" id="L209">		return getComponentModel().mode;</span>
	}

	/**
	 * @return the dialog title.
	 */
	public String getTitle() {
<span class="fc" id="L216">		return I18nUtilities.format(null, getComponentModel().title);</span>
	}

	/**
	 * Sets the dialog title.
	 *
	 * @param title the title to set, using {@link MessageFormat} syntax.
	 * @param args optional arguments for the message format string.
	 */
	public void setTitle(final String title, final Serializable... args) {
<span class="fc" id="L226">		getOrCreateComponentModel().title = I18nUtilities.asMessage(title, args);</span>
<span class="fc" id="L227">	}</span>

	// -------------------------------------------------------------
	// Action and Event Handling
	// -------------------------------------------------------------
	/**
	 * Override handleRequest in order to perform processing specific to this component.
	 *
	 * @param request the request being responded to.
	 */
	@Override
	public void handleRequest(final Request request) {
<span class="fc" id="L239">		boolean ajaxTargeted = isAjaxTargeted();</span>

<span class="pc bpc" id="L241" title="1 of 2 branches missed.">		if (ajaxTargeted) {</span>
			// This is necessary to support dialogs with a trigger,
			// where the display() method is not called explicitly
<span class="nc" id="L244">			getOrCreateComponentModel().state = ACTIVE_STATE;</span>
<span class="pc bpc" id="L245" title="2 of 4 branches missed.">		} else if (getComponentModel().state == ACTIVE_STATE &amp;&amp; !ajaxTargeted) {</span>
<span class="fc" id="L246">			getOrCreateComponentModel().state = INACTIVE_STATE;</span>
		}
<span class="fc" id="L248">	}</span>

	/**
	 * {@inheritDoc}
	 */
	@Override
	protected void preparePaintComponent(final Request request) {
<span class="fc" id="L255">		super.preparePaintComponent(request);</span>
<span class="fc bfc" id="L256" title="All 2 branches covered.">		if (getContent() != null) {</span>
<span class="fc" id="L257">			AjaxHelper.registerContainer(getId(), getId(), getContent().getId(), request);</span>
		}
<span class="fc" id="L259">	}</span>

	/**
	 * Indicates whether the dialog is currently the target of an AJAX operation.
	 *
	 * @return true if the dialog is currently AJAX targeted, otherwise false.
	 */
	protected final boolean isAjaxTargeted() {
		// If the AJAX target is within the dialog, it should be visible.
<span class="fc" id="L268">		AjaxOperation operation = AjaxHelper.getCurrentOperation();</span>
<span class="fc bfc" id="L269" title="All 2 branches covered.">		if (operation == null) {</span>
<span class="fc" id="L270">			return false;</span>
		}

<span class="fc" id="L273">		String dialogId = getId();</span>
<span class="fc" id="L274">		String containerId = operation.getTargetContainerId();</span>

<span class="pc bpc" id="L276" title="3 of 4 branches missed.">		if (containerId != null &amp;&amp; containerId.startsWith(dialogId)) {</span>
			// target is the dialog, or somewhere within the dialog
<span class="nc" id="L278">			return true;</span>
		}

<span class="pc bpc" id="L281" title="2 of 4 branches missed.">		if (operation.getTargets() != null &amp;&amp; UIContextHolder.getCurrent() != null) {</span>
<span class="fc bfc" id="L282" title="All 2 branches covered.">			for (String targetId : operation.getTargets()) {</span>
<span class="fc bfc" id="L283" title="All 2 branches covered.">				if (targetId.startsWith(dialogId)) {</span>
<span class="fc" id="L284">					return true;</span>
				}
<span class="fc" id="L286">			}</span>
		}
<span class="fc" id="L288">		return false;</span>
	}

	/**
	 * Retrieves the state of the dialog in the given context.
	 *
	 * @return the current state of the dialog.
	 */
	public int getState() {
<span class="fc" id="L297">		return getComponentModel().state;</span>
	}

	/**
	 * {@inheritDoc}
	 */
	@Override // to make public
	public int getChildCount() {
<span class="fc" id="L305">		return super.getChildCount();</span>
	}

	/**
	 * {@inheritDoc}
	 */
	@Override // to make public
	public WComponent getChildAt(final int index) {
<span class="fc" id="L313">		return super.getChildAt(index);</span>
	}

	/**
	 * {@inheritDoc}
	 */
	@Override // to make public
	public int getIndexOfChild(final WComponent childComponent) {
<span class="fc" id="L321">		return super.getIndexOfChild(childComponent);</span>
	}

	@Override
	public List&lt;WComponent&gt; getChildren() {
<span class="nc" id="L326">		return super.getChildren();</span>
	}

	/**
	 * @return a String representation of this component, for debugging purposes.
	 */
	@Override
	public String toString() {
<span class="nc" id="L334">		String text = getTitle();</span>
<span class="nc bnc" id="L335" title="All 2 branches missed.">		text = text == null ? &quot;null&quot; : '&quot;' + text + '&quot;';</span>
<span class="nc" id="L336">		return toString(text, -1, -1) + childrenToString(getContent());</span>
	}

	/**
	 * Creates a new component model.
	 *
	 * @return a new DialogModel.
	 */
	@Override
	protected DialogModel newComponentModel() {
<span class="fc" id="L346">		return new DialogModel();</span>
	}

	/**
	 * {@inheritDoc}
	 */
	@Override
	protected DialogModel getComponentModel() {
<span class="fc" id="L354">		return (DialogModel) super.getComponentModel();</span>
	}

	/**
	 * {@inheritDoc}
	 */
	@Override
	protected DialogModel getOrCreateComponentModel() {
<span class="fc" id="L362">		return (DialogModel) super.getOrCreateComponentModel();</span>
	}

	/**
	 * Holds the state information of a WDialog.
	 *
	 * @author Yiannis Paschalidis
	 */
<span class="fc" id="L370">	public static class DialogModel extends ComponentModel {</span>

		/**
		 * The current state of the dialog.
		 */
<span class="fc" id="L375">		private int state = INACTIVE_STATE;</span>

		/**
		 * The dialog title text.
		 */
		private Serializable title;

		/**
		 * The dialog width, in pixels.
		 */
<span class="fc" id="L385">		private int width = 0;</span>

		/**
		 * The dialog height, in pixels.
		 */
<span class="fc" id="L390">		private int height = 0;</span>

		/**
		 * Indicates whether the dialog should be resizable.
		 */
<span class="fc" id="L395">		private boolean resizable = true;</span>

		/**
		 * The content to be displayed in the dialog.
		 */
		private WComponent content;

		/**
		 * The relationship between the parent window and this dialog window. Possible values are {@link #MODAL} and
		 * {@link #MODELESS}.
		 */
<span class="fc" id="L406">		private int mode = MODELESS;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>