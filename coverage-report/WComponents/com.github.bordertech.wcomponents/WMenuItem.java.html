<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../resources/report.gif" type="image/gif"/><title>WMenuItem.java</title><link rel="stylesheet" href="../../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">WComponents Coverage</a> &gt; <a href="../index.html" class="el_bundle">WComponents</a> &gt; <a href="index.source.html" class="el_package">com.github.bordertech.wcomponents</a> &gt; <span class="el_source">WMenuItem.java</span></div><h1>WMenuItem.java</h1><pre class="source lang-java linenums">package com.github.bordertech.wcomponents;

import com.github.bordertech.wcomponents.util.I18nUtilities;
import java.io.Serializable;
import java.text.MessageFormat;
import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

/**
 * This component provides a menu item for use either directly in the top level of a {@link WMenu} or as an item within
 * a {@link WSubMenu} or {@link WMenuItemGroup}.
 *
 * @author Adam Millard
 * @author Yiannis Paschalidis
 * @author Jonathan Austin
 * @since 1.0.0
 */
public class WMenuItem extends AbstractContainer implements Disableable, AjaxTrigger, MenuItemSelectable {

	/**
	 * The logger instance for this class.
	 */
<span class="fc" id="L23">	private static final Log LOG = LogFactory.getLog(WMenuItem.class);</span>

	/**
	 * The decorated label which holds the menu item's text/icon etc.
	 */
	private final WDecoratedLabel label;

	/**
	 * Creates a WMenuItem with the given label.
	 *
	 * @param label the menu item label.
	 */
<span class="fc" id="L35">	public WMenuItem(final WDecoratedLabel label) {</span>
<span class="fc" id="L36">		this.label = label;</span>
<span class="fc" id="L37">		add(label);</span>
<span class="fc" id="L38">	}</span>

	/**
	 * Creates a WMenuItem with the given label and url.
	 *
	 * @param label the menu item label.
	 * @param url the URL to navigate to when the menu item is invoked.
	 */
	public WMenuItem(final WDecoratedLabel label, final String url) {
<span class="fc" id="L47">		this(label);</span>
<span class="fc" id="L48">		getComponentModel().url = url;</span>
<span class="fc" id="L49">	}</span>

	/**
	 * Creates a WMenuItem with the given label and action.
	 *
	 * @param label the menu item label.
	 * @param action the action to execute when the menu item is invoked.
	 */
	public WMenuItem(final WDecoratedLabel label, final Action action) {
<span class="fc" id="L58">		this(label);</span>
<span class="fc" id="L59">		getComponentModel().action = action;</span>
<span class="fc" id="L60">	}</span>

	/**
	 * Creates a WMenuItem with the given text and url.
	 *
	 * @param text the menu item text.
	 * @param url the URL to navigate to when the menu item is invoked.
	 */
	public WMenuItem(final String text, final String url) {
<span class="fc" id="L69">		this(text);</span>
<span class="fc" id="L70">		getComponentModel().url = url;</span>
<span class="fc" id="L71">	}</span>

	/**
	 * Creates a WMenuItem with the given label and action.
	 *
	 * @param text the menu item text.
	 * @param action the action to execute when the menu item is invoked.
	 */
	public WMenuItem(final String text, final Action action) {
<span class="fc" id="L80">		this(text);</span>
<span class="fc" id="L81">		getComponentModel().action = action;</span>
<span class="fc" id="L82">	}</span>

	/**
	 * Creates a new WMenuItem with the specified text.
	 *
	 * @param text the menu item's text.
	 */
	public WMenuItem(final String text) {
<span class="fc" id="L90">		this(new WDecoratedLabel());</span>
<span class="fc" id="L91">		label.setBody(new WText(text));</span>
<span class="fc" id="L92">	}</span>

	/**
	 * Creates a new WMenuItem with the specified text and accessKey.
	 *
	 * @param text the menu item's text.
	 * @param accessKey the menu item's access key.
	 */
	public WMenuItem(final String text, final char accessKey) {
<span class="fc" id="L101">		this(text);</span>
<span class="fc" id="L102">		setAccessKey(accessKey);</span>
<span class="fc" id="L103">	}</span>

	/**
	 * Creates a new WMenuItem with the specified text, accessKey and action.
	 *
	 * @param text the menu item's text.
	 * @param accessKey the menu item's access key.
	 * @param action the action to execute when the menu item is invoked.
	 */
	public WMenuItem(final String text, final char accessKey, final Action action) {
<span class="fc" id="L113">		this(text, accessKey);</span>
<span class="fc" id="L114">		getComponentModel().action = action;</span>
<span class="fc" id="L115">	}</span>

	/**
	 * @return the decorated label which displays the menu item's text/icon etc.
	 */
	public WDecoratedLabel getDecoratedLabel() {
<span class="fc" id="L121">		return label;</span>
	}

	/**
	 * @return the menu item's action, or null if there is no action specified.
	 */
	public Action getAction() {
<span class="fc" id="L128">		return getComponentModel().action;</span>
	}

	/**
	 * Sets the action to execute when the menu item is invoked.
	 *
	 * @param action the menu item's action.
	 */
	public void setAction(final Action action) {
<span class="fc" id="L137">		MenuItemModel model = getOrCreateComponentModel();</span>
<span class="fc" id="L138">		model.action = action;</span>
<span class="fc" id="L139">		model.url = null;</span>
<span class="fc" id="L140">	}</span>

	/**
	 * Retrieves the menu item's URL.
	 *
	 * @return the menu item's url, or null if there is no url specified.
	 */
	public String getUrl() {
<span class="fc" id="L148">		return getComponentModel().url;</span>
	}

	/**
	 * Sets the URL to navigate to when the menu item is invoked.
	 *
	 * @param url the url to set.
	 */
	public void setUrl(final String url) {
<span class="fc" id="L157">		MenuItemModel model = getOrCreateComponentModel();</span>
<span class="fc" id="L158">		model.url = url;</span>
<span class="fc" id="L159">		model.action = null;</span>
<span class="fc" id="L160">	}</span>

	/**
	 * &lt;p&gt;
	 * Indicates whether the form should be submitted when the menu item is selected. By default, the form will only be
	 * submitted if an action has been set on this item.
	 * &lt;/p&gt;
	 * &lt;p&gt;
	 * Examples of where the form might should not be submitted include if the menu item is within a sub-menu which
	 * supports multiple selection, or if the menu item points at an external URL.
	 * &lt;/p&gt;
	 *
	 * @return true if the form should be submitted when the menu item is selected.
	 */
	public boolean isSubmit() {
<span class="fc bfc" id="L175" title="All 2 branches covered.">		return getAction() != null;</span>
	}

	/**
	 * Retrieves the menu item text.
	 *
	 * @return the menu item text
	 */
	public String getText() {
<span class="fc" id="L184">		return getDecoratedLabel().getText();</span>
	}

	/**
	 * Sets the text of the menu item.
	 *
	 * @param text the text to set.
	 */
	public void setText(final String text) {
<span class="fc" id="L193">		getDecoratedLabel().setText(text);</span>
<span class="fc" id="L194">	}</span>

	/**
	 * Retrieves the target window name.
	 *
	 * @return the target window name.
	 */
	public String getTargetWindow() {
<span class="fc" id="L202">		return getComponentModel().targetWindow;</span>
	}

	/**
	 * Sets this menu item's target window name.
	 *
	 * @param targetWindow the target window name.
	 */
	public void setTargetWindow(final String targetWindow) {
<span class="fc" id="L211">		getOrCreateComponentModel().targetWindow = targetWindow;</span>
<span class="fc" id="L212">	}</span>

	/**
	 * @return true if this item is selectable, false if not, or null to default to the container.
	 * @deprecated Use {@link #getSelectability()} instead.
	 */
	@Deprecated
	public Boolean isSelectable() {
<span class="fc" id="L220">		return getSelectability();</span>
	}

	/**
	 * @param selectable true if this item is selectable, false if not, or null to default to the container.
	 * @deprecated Use {@link #setSelectability(java.lang.Boolean)} instead.
	 */
	@Deprecated
	public void setSelectable(final Boolean selectable) {
<span class="fc" id="L229">		setSelectability(selectable);</span>
<span class="fc" id="L230">	}</span>

	/**
	 * {@inheritDoc}
	 */
	@Override
	public boolean isSelected() {
<span class="fc" id="L237">		WMenu menu = WebUtilities.getAncestorOfClass(WMenu.class, this);</span>

<span class="pc bpc" id="L239" title="1 of 2 branches missed.">		if (menu != null) {</span>
<span class="fc" id="L240">			return menu.getSelectedMenuItems().contains(this);</span>
		}

<span class="nc" id="L243">		return false;</span>
	}

	/**
	 * {@inheritDoc}
	 */
	@Override
	public Boolean getSelectability() {
<span class="fc" id="L251">		return getComponentModel().selectability;</span>
	}

	/**
	 * @param selectability true if this item is selectable, false if not, or null to default to the container.
	 */
	@Override
	public void setSelectability(final Boolean selectability) {
<span class="fc" id="L259">		getOrCreateComponentModel().selectability = selectability;</span>
<span class="fc" id="L260">	}</span>

	/**
	 * Indicates whether this menu item is disabled in the given context.
	 *
	 * @return true if this menu item is disabled, false if it is enabled.
	 */
	@Override
	public boolean isDisabled() {
<span class="fc" id="L269">		boolean disabled = false;</span>

<span class="fc" id="L271">		MenuContainer container = (MenuContainer) WebUtilities.getAncestorOfClass(MenuContainer.class, this);</span>
<span class="pc bpc" id="L272" title="3 of 4 branches missed.">		if (container instanceof MenuItemGroup &amp;&amp; container instanceof Disableable) {</span>
<span class="nc" id="L273">			disabled = ((Disableable) container).isDisabled();</span>
		}

<span class="pc bpc" id="L276" title="1 of 4 branches missed.">		return disabled || isFlagSet(ComponentModel.DISABLED_FLAG);</span>
	}

	/**
	 * Sets whether this menu item is disabled.
	 *
	 * @param disabled true to set the item disabled, false for enabled.
	 */
	@Override
	public void setDisabled(final boolean disabled) {
<span class="fc" id="L286">		setFlag(ComponentModel.DISABLED_FLAG, disabled);</span>
<span class="fc" id="L287">	}</span>

	/**
	 * @return the menu item's accesskey.
	 */
	public char getAccessKey() {
<span class="fc" id="L293">		return getComponentModel().accessKey;</span>
	}

	/**
	 * Set the accesskey on the menu item button or link. For more information on access keys see
	 * {@link WButton#setAccessKey(char)}.
	 *
	 * @param accesskey The key that will form a keyboard shortcut to the menu item.
	 */
	public void setAccessKey(final char accesskey) {
<span class="fc" id="L303">		getOrCreateComponentModel().accessKey = accesskey;</span>
<span class="fc" id="L304">	}</span>

	/**
	 * Returns the accesskey character as a String. If the character is not a letter or digit then &lt;code&gt;null&lt;/code&gt; is
	 * returned.
	 *
	 * @return The accesskey character as a String (may be &lt;code&gt;null&lt;/code&gt;).
	 */
	public String getAccessKeyAsString() {
<span class="fc" id="L313">		char accessKey = getAccessKey();</span>

<span class="fc bfc" id="L315" title="All 2 branches covered.">		if (Character.isLetterOrDigit(accessKey)) {</span>
<span class="fc" id="L316">			return String.valueOf(accessKey);</span>
		}

<span class="fc" id="L319">		return null;</span>
	}

	/**
	 * Retrieves this menu item's action command.
	 *
	 * @return the actionCommand.
	 */
	public String getActionCommand() {
<span class="fc" id="L328">		return getComponentModel().actionCommand;</span>
	}

	/**
	 * Sets this menu item's action command.
	 *
	 * @param actionCommand The actionCommand to set.
	 */
	public void setActionCommand(final String actionCommand) {
<span class="fc" id="L337">		getOrCreateComponentModel().actionCommand = actionCommand;</span>
<span class="fc" id="L338">	}</span>

	/**
	 * Retrieves this menu item's action object.
	 *
	 * @return the actionObject.
	 */
	public Serializable getActionObject() {
<span class="fc" id="L346">		return getComponentModel().actionObject;</span>
	}

	/**
	 * Sets this menu item's action object.
	 *
	 * @param actionObject The actionObject to set.
	 */
	public void setActionObject(final Serializable actionObject) {
<span class="fc" id="L355">		getOrCreateComponentModel().actionObject = actionObject;</span>
<span class="fc" id="L356">	}</span>

	/**
	 * @return the confirmation message for the menu item.
	 */
	public String getMessage() {
<span class="fc" id="L362">		return I18nUtilities.format(null, getComponentModel().message);</span>
	}

	/**
	 * Sets the confirmation message that is to be displayed to the user for this menu item.
	 *
	 * @param message the confirmation message to display, using {@link MessageFormat} syntax.
	 * @param args optional arguments for the message format string.
	 */
	public void setMessage(final String message, final Serializable... args) {
<span class="fc" id="L372">		getOrCreateComponentModel().message = I18nUtilities.asMessage(message, args);</span>
<span class="fc" id="L373">	}</span>

	/**
	 * @return true if menu item is a cancel control and will warn the user of unsaved changes, otherwise false
	 */
	public boolean isCancel() {
<span class="fc" id="L379">		return getComponentModel().cancel;</span>
	}

	/**
	 * @param cancel true if menu item is a cancel control and will warn the user of unsaved changes, otherwise false
	 */
	public void setCancel(final boolean cancel) {
<span class="fc" id="L386">		getOrCreateComponentModel().cancel = cancel;</span>
<span class="fc" id="L387">	}</span>

	/**
	 * Override handleRequest in order to perform processing for this component. This implementation checks for
	 * selection of the menu item, and executes the associated action if it has been set.
	 *
	 * @param request the request being responded to.
	 */
	@Override
	public void handleRequest(final Request request) {
<span class="fc bfc" id="L397" title="All 2 branches covered.">		if (isDisabled()) {</span>
			// Protect against client-side tampering of disabled/read-only fields.
<span class="fc" id="L399">			return;</span>
		}

<span class="fc bfc" id="L402" title="All 2 branches covered.">		if (isMenuPresent(request)) {</span>
<span class="fc" id="L403">			String requestValue = request.getParameter(getId());</span>

<span class="fc bfc" id="L405" title="All 2 branches covered.">			if (requestValue != null) {</span>
				// Only process on a POST
<span class="pc bpc" id="L407" title="1 of 2 branches missed.">				if (!&quot;POST&quot;.equals(request.getMethod())) {</span>
<span class="nc" id="L408">					LOG.warn(&quot;Menu item on a request that is not a POST. Will be ignored.&quot;);</span>
<span class="nc" id="L409">					return;</span>
				}

				// Execute associated action, if set
<span class="fc" id="L413">				final Action action = getAction();</span>

<span class="pc bpc" id="L415" title="1 of 2 branches missed.">				if (action != null) {</span>
<span class="fc" id="L416">					final ActionEvent event = new ActionEvent(this, this.getActionCommand(), this.</span>
<span class="fc" id="L417">							getActionObject());</span>

<span class="fc" id="L419">					Runnable later = new Runnable() {</span>
						@Override
						public void run() {
<span class="fc" id="L422">							action.execute(event);</span>
<span class="fc" id="L423">						}</span>
					};

<span class="fc" id="L426">					invokeLater(later);</span>
				}
			}
		}
<span class="fc" id="L430">	}</span>

	/**
	 * Determine if this WMenuItem's parent WMenu is on the Request.
	 *
	 * @param request the request being responded to.
	 * @return true if this WMenuItem's WMenu is on the Request, otherwise return false.
	 */
	protected boolean isMenuPresent(final Request request) {
<span class="fc" id="L439">		WMenu menu = WebUtilities.getAncestorOfClass(WMenu.class, this);</span>

<span class="pc bpc" id="L441" title="1 of 2 branches missed.">		if (menu != null) {</span>
<span class="fc" id="L442">			return menu.isPresent(request);</span>
		}

<span class="nc" id="L445">		return false;</span>
	}

	/**
	 * @return a String representation of this component, for debugging purposes.
	 */
	@Override
	public String toString() {
<span class="nc" id="L453">		String text = getText();</span>
<span class="nc bnc" id="L454" title="All 2 branches missed.">		text = text == null ? &quot;null&quot; : ('&quot;' + text + '&quot;');</span>
<span class="nc" id="L455">		return toString(text, -1, -1);</span>
	}

	/**
	 * Creates a new component model.
	 *
	 * @return a new MenuItemModel.
	 */
	@Override
	protected MenuItemModel newComponentModel() {
<span class="fc" id="L465">		return new MenuItemModel();</span>
	}

	/**
	 * {@inheritDoc}
	 */
	@Override
	// For type safety only
	protected MenuItemModel getComponentModel() {
<span class="fc" id="L474">		return (MenuItemModel) super.getComponentModel();</span>
	}

	/**
	 * {@inheritDoc}
	 */
	@Override
	// For type safety only
	protected MenuItemModel getOrCreateComponentModel() {
<span class="fc" id="L483">		return (MenuItemModel) super.getOrCreateComponentModel();</span>
	}

	/**
	 * Holds the extrinsic state information of a WMenuItem.
	 */
<span class="fc" id="L489">	public static class MenuItemModel extends ComponentModel {</span>

		/**
		 * An (external) url to open when the menu item is selected.
		 */
		private String url;

		/**
		 * Used together with the url parameter to launch the url in a new window.
		 */
		private String targetWindow;

		/**
		 * The menu item's access key.
		 */
		private char accessKey;

		/**
		 * The action to execute when the menu item is selected.
		 */
		private Action action;

		/**
		 * The action command to pass to the menu item's action when it executes.
		 */
		private String actionCommand;

		/**
		 * The action object to pass to the menu item's action when it executes.
		 */
		private Serializable actionObject;

		/**
		 * Indicates whether the sub-menu itself can be selected (e.g. for column menus).
		 */
		private Boolean selectability;

		/**
		 * The confirmation message to be shown.
		 */
		private Serializable message;

		/**
		 * Act as a cancel control and warn the user of unsaved changes.
		 */
		private boolean cancel;

	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>