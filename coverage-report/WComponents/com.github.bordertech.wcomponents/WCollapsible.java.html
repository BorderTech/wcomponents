<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../resources/report.gif" type="image/gif"/><title>WCollapsible.java</title><link rel="stylesheet" href="../../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">WComponents Coverage</a> &gt; <a href="../index.html" class="el_bundle">WComponents</a> &gt; <a href="index.source.html" class="el_package">com.github.bordertech.wcomponents</a> &gt; <span class="el_source">WCollapsible.java</span></div><h1>WCollapsible.java</h1><pre class="source lang-java linenums">package com.github.bordertech.wcomponents;

import com.github.bordertech.wcomponents.util.SystemException;

/**
 * &lt;p&gt;
 * The WCollapsible component enables a given component to be expanded/collapsed (shown/hidden) via clicking on the
 * collapsible's header section. When a user clicks the heading, the visibility of the collapsible's content is
 * toggled.&lt;/p&gt;
 *
 * &lt;p&gt;
 * Various {@link CollapsibleMode modes of operation} are supported, which allow developers to tune performance by only
 * loading content when it is needed.&lt;/p&gt;
 *
 * @author Martin Shevchenko
 */
public class WCollapsible extends AbstractNamingContextContainer implements AjaxTarget,
		SubordinateTarget, Marginable {

	/**
	 * The available types of collapsible mode.
	 *
	 * @author Yiannis Paschalidis
	 */
<span class="pc" id="L25">	public enum CollapsibleMode {</span>
		/**
		 * Indicates that expanding/collapsing involves a round-trip to the server. The collapsible content will be
		 * rendered only when the collapsible is open.
		 *
		 * @deprecated Use CollapsibleMode DYNAMIC instead as a like-for-like replacement or any other mode if it is
		 * more appropriate to the individual use case.
		 */
<span class="fc" id="L33">		SERVER,</span>
		/**
		 * Indicates that expanding/collapsing is performed client-side, using a single AJAX request to obtain the
		 * content the first time the collapsible is expanded.
		 */
<span class="fc" id="L38">		LAZY,</span>
		/**
		 * Indicates that expanding/collapsing is handled on the client. The content is always rendered, and no
		 * additional trips to the server are made.
		 */
<span class="fc" id="L43">		CLIENT,</span>
		/**
		 * Indicates that expanding/collapsing is performed using AJAX requests. A request will be made every time the
		 * collapsible is expanded.
		 */
<span class="fc" id="L48">		DYNAMIC,</span>
		/**
		 * Indicates that expanding/collapsing is performed client-side, using a single AJAX request to obtain the
		 * content immediately after the page loads.
		 */
<span class="fc" id="L53">		EAGER</span>
	};

	/**
	 * The content to display inside the collapsible.
	 */
	private final WComponent content;

	/**
	 * The label for the collapsible's heading.
	 */
	private final WDecoratedLabel label;

	/**
	 * Creates a WCollapsible with the given content and heading.
	 *
	 * @param content the content to display inside the collapsible.
	 * @param heading the collapsible's heading.
	 */
	public WCollapsible(final WComponent content, final String heading) {
<span class="fc" id="L73">		this(content, new WDecoratedLabel(heading), CollapsibleMode.CLIENT, null);</span>
<span class="fc" id="L74">	}</span>

	/**
	 * Creates a WCollapsible with the given content and heading.
	 *
	 * @param content the content to display inside the collapsible.
	 * @param label the collapsible's heading.
	 */
	public WCollapsible(final WComponent content, final WDecoratedLabel label) {
<span class="nc" id="L83">		this(content, label, CollapsibleMode.CLIENT, null);</span>
<span class="nc" id="L84">	}</span>

	/**
	 * Creates a WCollapsible with the given content and heading.
	 *
	 * @param content the content to display inside the collapsible.
	 * @param heading the collapsible's heading.
	 * @param mode the mode of the collapsible
	 */
	public WCollapsible(final WComponent content, final String heading, final CollapsibleMode mode) {
<span class="fc" id="L94">		this(content, new WDecoratedLabel(heading), mode, null);</span>
<span class="fc" id="L95">	}</span>

	/**
	 * Creates a WCollapsible with the given content and heading.
	 *
	 * @param content the content to display inside the collapsible.
	 * @param label the collapsible's heading.
	 * @param mode the mode of the collapsible
	 */
	public WCollapsible(final WComponent content, final WDecoratedLabel label,
			final CollapsibleMode mode) {
<span class="nc" id="L106">		this(content, label, mode, null);</span>
<span class="nc" id="L107">	}</span>

	/**
	 * Creates a WCollapsible with the given content, heading and group.
	 *
	 * @param content the content to display inside the collapsible.
	 * @param heading the collapsible's heading.
	 * @param mode the mode of the collapsible
	 * @param group the {@link CollapsibleGroup} that this collapsible belongs to.
	 */
	public WCollapsible(final WComponent content, final String heading, final CollapsibleMode mode,
			final CollapsibleGroup group) {
<span class="nc" id="L119">		this(content, new WDecoratedLabel(heading), mode, group);</span>
<span class="nc" id="L120">	}</span>

	/**
	 * Creates a WCollapsible with the given content, heading and group.
	 *
	 * @param content the content to display inside the collapsible.
	 * @param label the collapsible's heading.
	 * @param mode the mode of the collapsible
	 * @param group the {@link CollapsibleGroup} that this collapsible belongs to.
	 */
	public WCollapsible(final WComponent content, final WDecoratedLabel label,
			final CollapsibleMode mode,
<span class="fc" id="L132">			final CollapsibleGroup group) {</span>
<span class="fc" id="L133">		getComponentModel().mode = mode;</span>
<span class="fc" id="L134">		this.content = content;</span>
<span class="fc" id="L135">		this.label = label;</span>
<span class="fc" id="L136">		add(label);</span>
<span class="fc" id="L137">		add(content);</span>

<span class="pc bpc" id="L139" title="1 of 2 branches missed.">		if (group != null) {</span>
<span class="nc" id="L140">			setGroup(group);</span>
		}
<span class="fc" id="L142">	}</span>

	/**
	 * @return this WCollapsible's mode of operation
	 */
	public CollapsibleMode getMode() {
<span class="fc" id="L148">		return getComponentModel().mode;</span>
	}

	/**
	 * Sets this WCollapsible's mode of operation.
	 *
	 * @param mode the mode of operation.
	 */
	public void setMode(final CollapsibleMode mode) {
<span class="nc" id="L157">		getOrCreateComponentModel().mode = mode;</span>
<span class="nc" id="L158">	}</span>

	/**
	 * {@inheritDoc}
	 */
	@Override
	public void setMargin(final Margin margin) {
<span class="fc" id="L165">		getOrCreateComponentModel().margin = margin;</span>
<span class="fc" id="L166">	}</span>

	/**
	 * {@inheritDoc}
	 */
	@Override
	public Margin getMargin() {
<span class="fc" id="L173">		return getComponentModel().margin;</span>
	}

	/**
	 * Indicates whether the collapsible is collapsed in the given context.
	 *
	 * @return true if the collapsible is collapsed for the given user, false if expanded.
	 */
	public boolean isCollapsed() {
<span class="fc" id="L182">		return getComponentModel().collapsed;</span>
	}

	/**
	 * Sets whether the collapsible is collapsed in the given context.
	 *
	 * @param collapsed true if the collapsible is to be collapsed for the given user, false if expanded.
	 */
	public void setCollapsed(final boolean collapsed) {
<span class="fc" id="L191">		getOrCreateComponentModel().collapsed = collapsed;</span>
<span class="fc" id="L192">	}</span>

	/**
	 * @return the content of this collapsible
	 */
	public WComponent getContent() {
<span class="fc" id="L198">		return this.content;</span>
	}

	/**
	 * @return the decorated label that is used to render the collapsible heading.
	 */
	public WDecoratedLabel getDecoratedLabel() {
<span class="fc" id="L205">		return label;</span>
	}

	/**
	 * Retrieves the collapsible's default heading.
	 *
	 * @return the heading text.
	 *
	 * @deprecated use {@link #getDecoratedLabel()}.getText()
	 */
	@Deprecated
	public String getHeading() {
<span class="fc" id="L217">		return label.getText();</span>
	}

	/**
	 * Sets the collapsible's heading for the given context.
	 *
	 * @param heading the heading text to set.
	 *
	 * @deprecated use {@link #getDecoratedLabel()}.setText(String)
	 */
	@Deprecated
	public void setHeading(final String heading) {
<span class="fc" id="L229">		label.setText(heading);</span>
<span class="fc" id="L230">	}</span>

	/**
	 * The group name that this collapsible component belongs to. If it is not part of a group then the name defaults to
	 * {@link WComponent#getName()}.
	 *
	 * @return the collapsible group name
	 */
	public String getGroupName() {
<span class="fc" id="L239">		CollapsibleGroup group = getComponentModel().group;</span>
<span class="fc bfc" id="L240" title="All 2 branches covered.">		return (group == null ? getId() : group.getGroupName());</span>
	}

	/**
	 * Set the {@link CollapsibleGroup} that this component belongs to. This will enable a {@link WCollapsibleToggle}
	 * component to target the group.
	 *
	 * @param group the group to set
	 */
	public void setGroup(final CollapsibleGroup group) {
<span class="fc" id="L250">		getOrCreateComponentModel().group = group;</span>
<span class="fc" id="L251">		group.addCollapsible(this);</span>
<span class="fc" id="L252">	}</span>

	/**
	 * @return the collapsible's heading level
	 */
	public HeadingLevel getHeadingLevel() {
<span class="fc" id="L258">		return getComponentModel().headingLevel;</span>
	}

	/**
	 * @param headingLevel the collapsible's heading level
	 */
	public void setHeadingLevel(final HeadingLevel headingLevel) {
<span class="fc" id="L265">		getOrCreateComponentModel().headingLevel = headingLevel;</span>
<span class="fc" id="L266">	}</span>

	/**
	 * Override handleRequest to perform processing necessary for this component. This is used to handle the server-side
	 * collapsible mode and to synchronise with the client-side state for the other modes.
	 *
	 * @param request the request being responded to.
	 */
	@Override
	public void handleRequest(final Request request) {
<span class="fc" id="L276">		String clientState = request.getParameter(getId());</span>

<span class="fc bfc" id="L278" title="All 2 branches covered.">		if (clientState != null) {</span>
<span class="fc" id="L279">			setCollapsed(clientState.equalsIgnoreCase(&quot;closed&quot;));</span>
		}
<span class="fc" id="L281">	}</span>

	/**
	 * Override preparePaintComponent in order to toggle the visibility of the content, or to register the appropriate
	 * ajax operation.
	 *
	 * @param request the request being responded to
	 */
	@Override
	protected void preparePaintComponent(final Request request) {
<span class="fc" id="L291">		super.preparePaintComponent(request);</span>

<span class="pc bpc" id="L293" title="1 of 2 branches missed.">		if (content != null) {</span>
<span class="pc bpc" id="L294" title="1 of 6 branches missed.">			switch (getMode()) {</span>
				case EAGER: {
					// Always visible
<span class="fc" id="L297">					content.setVisible(true);</span>
<span class="fc" id="L298">					AjaxHelper.registerContainer(getId(), getId() + &quot;-content&quot;, content.getId(),</span>
							request);
<span class="fc" id="L300">					break;</span>
				}
				case LAZY:
<span class="fc bfc" id="L303" title="All 2 branches covered.">					content.setVisible(!isCollapsed());</span>

<span class="fc bfc" id="L305" title="All 2 branches covered.">					if (isCollapsed()) {</span>
<span class="fc" id="L306">						AjaxHelper.registerContainer(getId(), getId() + &quot;-content&quot;, content.getId(),</span>
								request);
					}

					break;

				case DYNAMIC: {
<span class="fc bfc" id="L313" title="All 2 branches covered.">					content.setVisible(!isCollapsed());</span>
<span class="fc" id="L314">					AjaxHelper.registerContainer(getId(), getId() + &quot;-content&quot;, content.getId(),</span>
							request);
<span class="fc" id="L316">					break;</span>
				}
				case SERVER: {
<span class="fc bfc" id="L319" title="All 2 branches covered.">					content.setVisible(!isCollapsed());</span>
<span class="fc" id="L320">					break;</span>
				}
				case CLIENT: {
					// Will always be visible
<span class="fc" id="L324">					content.setVisible(true);</span>
<span class="fc" id="L325">					break;</span>
				}
				default: {
<span class="nc" id="L328">					throw new SystemException(&quot;Unknown mode: &quot; + getMode());</span>
				}
			}
		}
<span class="fc" id="L332">	}</span>

	/**
	 * @return a String representation of this component, for debugging purposes.
	 */
	@Override
	public String toString() {
<span class="nc bnc" id="L339" title="All 2 branches missed.">		String text = label == null ? null : label.getText();</span>
<span class="nc bnc" id="L340" title="All 2 branches missed.">		text = text == null ? &quot;null&quot; : '&quot;' + text + '&quot;';</span>
<span class="nc" id="L341">		return toString(text, 1, 1);</span>
	}

	/**
	 * Creates a new component model appropriate for this component.
	 *
	 * @return a new CollapsibleModel.
	 */
	@Override
	protected CollapsibleModel newComponentModel() {
<span class="fc" id="L351">		return new CollapsibleModel();</span>
	}

	/**
	 * {@inheritDoc}
	 */
	@Override // For type safety only
	protected CollapsibleModel getComponentModel() {
<span class="fc" id="L359">		return (CollapsibleModel) super.getComponentModel();</span>
	}

	/**
	 * {@inheritDoc}
	 */
	@Override // For type safety only
	protected CollapsibleModel getOrCreateComponentModel() {
<span class="fc" id="L367">		return (CollapsibleModel) super.getOrCreateComponentModel();</span>
	}

	/**
	 * Holds the extrinsic state information of a WCollapsible.
	 */
<span class="fc" id="L373">	public static class CollapsibleModel extends ComponentModel {</span>

		/**
		 * Indicates whether the collapsible is collapsed.
		 */
<span class="fc" id="L378">		private boolean collapsed = true;</span>

		/**
		 * The CollapsibleGroup, primarily used with a {@link #CollapsibleToggle} to toggle a group of collapsibles at
		 * once.
		 */
		private CollapsibleGroup group;

		/**
		 * Indicates how the collapsible should operate.
		 */
		private CollapsibleMode mode;

		/**
		 * The margins to be used on the collapsible.
		 */
		private Margin margin;

		/**
		 * The heading level.
		 */
		private HeadingLevel headingLevel;
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>